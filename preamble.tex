% Load essential packages
\usepackage{booktabs}
\usepackage{amsthm}
\usepackage{svg}
\usepackage[english,danish]{babel} % Danish for labels, English for hyphenation
\selectlanguage{danish}

\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{xcolor}
\usepackage{hyperref}

% Figure title above figures
\usepackage{floatrow}
\floatsetup[figure]{capposition=top}

% Customize captions
\usepackage{caption}
\captionsetup[figure]{name=Figur, labelfont=bf, textfont=it, font=small}
\captionsetup[table]{name=Tabel, labelfont=bf, textfont=it, font=small}

% Rename TOC and appendix heading
\addto\captionsdanish{\renewcommand{\contentsname}{Indholdsfortegnelse}}
\addto\captionsdanish{\renewcommand{\appendixname}{Bilag}}

% Support for conditional formatting in appendix
\usepackage{etoolbox}
\makeatletter
\newif\if@appendix
\let\oldappendix\appendix
\renewcommand{\appendix}{\@appendixtrue\oldappendix}
\makeatother

% Customize chapter titles for regular chapters
\usepackage{titlesec}
\titleformat{\chapter}[display]
  {\normalfont\Huge\bfseries}
  {}
  {0pt}
  {\Huge}
  [\vspace{-10pt}]
\titlespacing*{\chapter}{0pt}{0pt}{10pt}

% Redefine chapter title format for appendix ("Bilag A", etc.)
\makeatletter
\pretocmd{\appendix}{
  \titleformat{\chapter}[display]
    {\normalfont\Huge\bfseries}
    {}
    {0pt}
    {\Huge}
    [\vspace{-10pt}]
}{}{}
\makeatother

% Page layout
\usepackage[a4paper, top=1in, bottom=1in, left=1.5in, right=1in, bindingoffset=0.5in]{geometry}

% Custom spacing for theorem environments
\makeatletter
\def\thm@space@setup{
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}
\makeatother

% Title page with image
\usepackage{titling}
\pretitle{\begin{center}
\includegraphics[width=5in,height=5in]{images/kap1.jpg}\LARGE\\}
\posttitle{\end{center}}

% Font setup
\usepackage{fontspec}
\setmainfont[
    BoldFont={Fira Sans SemiBold},
    ItalicFont={Fira Sans Italic},
    BoldItalicFont={Fira Sans SemiBold Italic}
]{Fira Sans}

% Page format and headers
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhead[L]{\footnotesize \leftmark}
\fancyhead[R]{\footnotesize \thepage}

% Roman page numbering before chapter 1
\pagenumbering{gobble}

\usepackage{atbegshi}
\AtBeginDocument{\AtBeginShipoutNext{\AtBeginShipoutDiscard}}

% Prevent footnote counter reset at each chapter
\usepackage{chngcntr}
\counterwithout{footnote}{chapter}
